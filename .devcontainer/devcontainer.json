{
  "name": "Tailnet Podman Environment",
  "build": {
    "dockerfile": "../Dockerfile",
    "context": ".."
  },
  "features": {
    "ghcr.io/devcontainers-extra/features/podman-homebrew:1": {},
    "ghcr.io/tailscale/codespace/tailscale": {
      "version": "latest"
    },
    "ghcr.io/devcontainers-contrib/features/homebrew-package:1": {
      "package": "podman-compose"
    }
  },
  "containerEnv": {
    "ENGINE": "podman",
    "SUPPORT": "https://github.com/mayas-alas/tailnet"
  },
  "runArgs": [
    "--device=/dev/net/tun",
    "--privileged",
    "--cap-add=SYS_ADMIN",
    "--cap-add=NET_ADMIN",
    "--cap-add=SYS_RESOURCE",
    "--cap-add=SYS_NICE",
    "--cap-add=NET_RAW",
    "--cap-add=IPC_LOCK",
    "--cap-add=SYS_PTRACE"
  ],
  "securityOpt": [
    "apparmor=unconfined",
    "seccomp=unconfined"
  ],
  "forwardPorts": [
    8006
  ],
  "portsAttributes": {
    "8006": {
      "label": "Web",
      "onAutoForward": "notify"
    }
  },
  "postCreateCommand": "sudo tailscale up --ssh --hostname=tailnet-dev"
}
